# Http
- 기반 프로토콜
> TCP : HTTP/1.1 ,  HTTP/2
> UDP : HTTP/3
- TCP가 안정적이긴 하나 UDP가 속도가 빠르고, 어플리케이션 단에서 최적화 함으로 UDP를 쓰는 추세다.
- 클라이언트 서버 구조
- 무상태 프로토콜(stateless)
- 비연결성(Connectionless)
### stateful vs stateless
- stateful - 서버가 클라이언트의 이전 상태를 보존(상태 유지 O, 항상 같은 서버 유지)<br/>
- stateless - 서버가 클라이언트의 상태를 보존하지 않음 (상태 유지 X) <br/>
> 장점 : 서버 확장성 높음(스케일 아웃)<br/>
> 단점 : 클라이언트가 추가 데이터 전송 (연속적인 프로세스일 때 응답 서버의 답을 저장하며 보내야함)
```
  stateful일 때는 응답 서버를 바꾸면 안된다.
  그에 반해 stateless일 때는 상태유지를 안 하기 때문에 응답 서버를 바꿔도 된다. 즉 아무 서버나 호출해도 상관없다.
  ex) 결제 도중 장애가 응답 서버에 장애가 날 경우 stateful일 때는 처음부터 다시 해야 하지만
  stateless는 다른 응답 서버를 투입하면서 문제를 해결할 수 있다.
```

### 연결성(Connection) vs 비연결성(Connectionless)
 - 연결을 유지하는 모델(TCP/IP)
 > 클라이언트 1,2,3이 각각 서버와 연결을 함(요청을 보내고 응답을 받음)<br/>
 > 이때 클라이언트1이 서버와 통신 중일 때 클라이언트3도 서버와 연결이 된 상태고 서버는 의미 없이 자원이 소모됨<br/>

- 연결을 유지하지 않는 모델(TCP/IP)
> 각 클라이언트가 서로 필요한 것만 주고 받고 연결을 끊어버림<br/>
> 서버를 유지하는 자원을 최소한으로 사용<br/>
> 사용자 입장에서 매번 3 way handshake를 해야하는 번거로움이 있음<br/>
> 웹 브라우저로 사이트를 요청하면 HTML 뿐만 아닌 Js,CSS 등 여러 자원이 함께 다운로드 -> Http 지속연결로 문제 해결 <br/>
```
지속 연결이란?
초기 Http에서 연결, 요청, 종료가 0.1초씩 걸리고 추가 요청이 있으면 매번 0.3초씩 추가된다고 가정하자.
지속 연결은 연결 후 어느 정도의 시간이 주어지고 그 시간 동안 요청이 처리된 후 종료되는 시스템
Http2, 3에서 최적화를 통해 해결을 한 상태
```
- HTTP 메시지
### Http 메서드
- GET : 리소스 조회
> 서버에 전달하고 싶은 데이터는 query를 통해 전달<br/>
> 메시지 바디를 사용해서 데이터를 전달할 순 있지만, 지원하지 않는 곳이 많아 권장하지 않음<br/>
- POST : 요청 데이터 처리, 주로 등록에 사용
> 메시지 바디를 통해 서버로 요청 데이터 전달 -> 서버는 요청 데이터를 처리<br/>
- PUT : 리소스를 대체, 해당 리소스가 없으면 생성
> 리소스를 완전히 대체한다
> > 기존 필드에 "age" : 20, "username":"kang" 이라는 값이 있고 <br/>
> > "age":50 을 전송하면 username은 사라지고 "age":50으로 바뀜 <br/>
> 클라이언트가 리소스 위치를 알고 URI 지정(POST와 차이점)
- PATCH : 리소스 부분 변경
> PUT에서 완전히 대체되는 성질을 부분 변경으로 바뀜
- DELETE : 리소스 삭제
### Http 메서드의 속성
- 안전 : 호출해도 리소스를 변경하지 않는다.
- 멱등 : 몇 번을 호출하든 결과가 똑같음. (외부 요인으로 중간에 리소스가 변경된 것은 고려하지 않음)
> GET : 여러번 호출을 해도 같은 결과가 조회된다.<br/>
> PUT : 똑같은 파일을 업로드해도 결과가 같다.<br/>
> DELETE : 결과를 삭제. 같은 요청을 여러번 해도 삭제된 결과는 똑같다.<br/>
> POST : 멱등 아님 -> 두 번 호출하면 같은 결제가 중복해서 발생할 수 있음. <br/>
> 활용 : 자동 복구 메커니즘 (서버가 Time Out 등으로 정상 응답을 못 주었을 때 <br/>
- 캐시 가능
> GET, POST, PATCH 캐시 가능하지만 실제로 GET정도만 사용<br/>
> POST, PATCH는 본문 내용까지 캐시 키로 고려해야 한다. (키시를 하려면 같은 리소스와 키가 맞아야 함)
> GET은 URL만 키로 잡고 캐시(심플)

### Http 메시지
- Http 메시지 구조
> start-line <br/>
> header     <br/>
> empty-line <br/>
> message body <br/>

- 요청 메시지
> ex) GET /search?q=hello&hl=ko HTTP/1.1<br/>
> ex) Host:www.google.com<br/>
> (공백)<br/>
> (body 있을 수도, 없을 수도)

- 응답 메시지
> ex) HTTP/1.1 200OK<br/>
> ex) Content-Type : text/html;charset=UTF-8 Content-Length:3423<br/>
> ex) (공백) <br/>
> ex) ```
<html> 
  <body? ... </body> 
</html>
```




